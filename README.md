# MEDIATOR (Медиатор)

**Медиатор** — веб‑приложение, которое оценивает эмоциональное состояние по выражению лица (камера) и помогает улучшить самочувствие через дыхательные/внимательные практики. Есть короткий тест после сканирования с камеры, история и дневник.

## Возможности
- Реальный‑тайм трекинг лица (face-api.js) + «снимок (точнее)»
- Подбор практик на основе эмоции (камера) и короткого теста
- Экран практики: таймер, подсказки, анимация дыхания, музыка
- Короткий тест после камеры + экран рекомендаций перед практикой
- История сессий + простой график
- Дневник заметок

## Как запустить локально
Камера работает **только** в безопасном контексте: `https` или `http://localhost`.

### Вариант 1 (самый простой)
1. Откройте терминал в папке проекта.
2. Запустите локальный сервер:

```bash
python -m http.server 8000
```
3. Откройте в браузере: `http://localhost:8000/`

### Вариант 2 (Node)
```bash
npx http-server -p 8000
```

## Деплой
- Для работы камеры на телефоне/в интернете нужен **HTTPS** (например, GitHub Pages + custom domain + HTTPS, Vercel, Netlify).
- При деплое убедитесь, что файлы `manifest.webmanifest` и `service-worker.js` доступны в корне.

## Технические детали
- Распознавание: `face-api.js` (TinyFaceDetector + landmarks + expressions)
- Модели подгружаются с публичного хоста моделей face-api (требуется интернет).

## Структура кода (для защиты/поддержки)
Логика разложена по файлам (загрузка в `index.html` идёт строго по порядку):

- `js/01-dom-theme.js` — DOM-ссылки, палитры, тема/бейджи
- `js/02-state-feedback.js` — состояние приложения, сохранение фидбека практик
- `js/03-tracking-quality.js` — realtime‑отрисовка, контроль качества кадра
- `js/04-models-camera-detect.js` — загрузка моделей, камера, детекции
- `js/05-practices.js` — каталог практик + плеер практик (оптимизации цикла)
- `js/06-quickhelp-test-nav.js` — быстрая помощь, тест, рекомендации, навигация

Исходный монолитный файл сохранён как `script.bundle.js` для удобства сравнения.

## Приватность
- В потоке приложения камера используется только на главном экране.
- При переходе в практику/историю/дневник видеопоток **останавливается**.

---

> Этап 1 (подготовка к релизу): добавлены PWA‑артефакты (manifest, иконки, service worker), улучшена устойчивость к ошибкам загрузки face-api и реализована остановка видеопотока вне главного экрана.

> Этап 2 (продуктовый сценарий): реализован поток камера → тест → рекомендации → практика; практики доступны только после теста, история сохраняет эмоцию, ответы теста и выбранную практику.

> Этап 3 (эмоциональный профиль): результат камеры стал стабильнее — профиль эмоций усредняется по нескольким измерениям, показывается оценка уверенности модели и топ‑3 эмоции; эти данные сохраняются в историю.

> Этап 4 (психо‑чек): добавлена нормализация ответов 1..5 → 0..1 и индексы «напряжение/ресурс», которые отображаются в тесте, рекомендациях и истории.

> Этап 5 (фьюжн‑оценка): объединение камеры и теста в итоговое состояние (например, тревожность/раздражение/апатия/стабильно) с вычислением оценки уверенности модели; итог отображается в рекомендациях и сохраняется в историю.
